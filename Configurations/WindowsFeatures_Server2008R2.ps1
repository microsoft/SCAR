Configuration WindowsFeatures_Server2008R2
{
    param(
        [ValidateSet('AD-Certificate','ADCS-Cert-Authority','ADCS-Web-Enrollment','ADCS-Enroll-Web-Svc','ADCS-Enroll-Web-Pol','AD-Domain-Services','ADDS-Domain-Controller','ADDS-Identity-Mgmt','ADDS-NIS','ADDS-Password-Sync','ADDS-IDMU-Tools','AD-Federation-Services','ADFS-Federation','ADFS-Proxy','ADFS-Web-Agents','ADFS-Claims','ADFS-Windows-Token','ADLDS','ADRMS','ADRMS-Server','ADRMS-Identity','Application-Server','AS-NET-Framework','AS-Web-Support','AS-Ent-Services','AS-TCP-Port-Sharing','AS-WAS-Support','AS-HTTP-Activation','AS-MSMQ-Activation','AS-TCP-Activation','AS-Named-Pipes','AS-Dist-Transaction','AS-Incoming-Trans','AS-Outgoing-Trans','AS-WS-Atomic','DHCP','DNS','Fax','File-Services','FS-FileServer','FS-DFS','FS-DFS-Namespace','FS-DFS-Replication','FS-Resource-Manager','FS-NFS-Services','FS-Search-Service','FS-Win2003-Services','FS-Indexing-Service','FS-BranchCache','Hyper-V','NPAS','NPAS-Policy-Server','NPAS-RRAS-Services','NPAS-RRAS','NPAS-Routing','NPAS-Health','NPAS-Host-Cred','Print-Services','Print-Server','Print-LPD-Service','Print-Internet','Print-Scan-Server','Remote-Desktop-Services','RDS-RD-Server','RDS-Virtualization','RDS-Virtualization-Core','RDS-RemoteFX','RDS-Licensing','RDS-Connection-Broker','RDS-Gateway','RDS-Web-Access','Web-Server','Web-WebServer','Web-Common-Http','Web-Static-Content','Web-Default-Doc','Web-Dir-Browsing','Web-Http-Errors','Web-Http-Redirect','Web-DAV-Publishing','Web-App-Dev','Web-Asp-Net','Web-Net-Ext','Web-ASP','Web-CGI','Web-ISAPI-Ext','Web-ISAPI-Filter','Web-Includes','Web-Health','Web-Http-Logging','Web-Log-Libraries','Web-Request-Monitor','Web-Http-Tracing','Web-Custom-Logging','Web-ODBC-Logging','Web-Security','Web-Basic-Auth','Web-Windows-Auth','Web-Digest-Auth','Web-Client-Auth','Web-Cert-Auth','Web-Url-Auth','Web-Filtering','Web-IP-Security','Web-Performance','Web-Stat-Compression','Web-Dyn-Compression','Web-Mgmt-Tools','Web-Mgmt-Console','Web-Scripting-Tools','Web-Mgmt-Service','Web-Mgmt-Compat','Web-Metabase','Web-WMI','Web-Lgcy-Scripting','Web-Lgcy-Mgmt-Console','Web-Ftp-Server','Web-Ftp-Service','Web-Ftp-Ext','Web-WHC','WDS','WDS-Deployment','WDS-Transport','OOB-WSUS','NET-Framework','NET-Framework-Core','NET-Win-CFAC','NET-HTTP-Activation','NET-Non-HTTP-Activ','BITS','BITS-Compact-Server','BITS-IIS-Ext','BitLocker','BranchCache','CMAK','Desktop-Experience','DAMC','GPMC','Ink-Handwriting','IH-Ink-Support','IH-Handwriting','Internet-Print-Client','ISNS','LPR-Port-Monitor','MSMQ','MSMQ-Services','MSMQ-Server','MSMQ-Directory','MSMQ-Triggers','MSMQ-HTTP-Support','MSMQ-Multicasting','MSMQ-Routing','MSMQ-DCOM','Multipath-IO','NLB','PNRP','qWave','Remote-Assistance','RDC','RSAT','RSAT-Role-Tools','RSAT-ADCS','RSAT-ADCS-Mgmt','RSAT-AD-Tools','RSAT-ADDS','RSAT-ADDS-Tools','RSAT-AD-AdminCenter','RSAT-SNIS','RSAT-ADLDS','RSAT-AD-PowerShell','RSAT-RMS','RSAT-DHCP','RSAT-DNS-Server','RSAT-Fax','RSAT-File-Services','RSAT-DFS-Mgmt-Con','RSAT-FSRM-Mgmt','RSAT-NFS-Admin','RSAT-Hyper-V','RSAT-NPAS','RSAT-Print-Services','RSAT-RDS','RSAT-RDS-RemoteApp','RSAT-RDS-Gateway','RSAT-RDS-Licensing','RSAT-RDS-Conn-Broker','RSAT-Web-Server','RSAT-WDS','RSAT-Feature-Tools','RSAT-BitLocker','RSAT-Bitlocker-DriveEnc','RSAT-Bitlocker-RecPwd','RSAT-Bits-Server','RSAT-Clustering','RSAT-NLB','RSAT-SMTP','RSAT-WINS','RPC-over-HTTP-Proxy','Simple-TCPIP','SMTP-Server','SNMP-Services','SNMP-Service','SNMP-WMI-Provider','Storage-Mgr-SANS','Subsystem-UNIX-Apps','Telnet-Client','Telnet-Server','TFTP-Client','Biometric-Framework','Windows-Internal-DB','PowerShell-ISE','WAS','WAS-Process-Model','WAS-NET-Environment','WAS-Config-APIs','Backup-Features','Backup','Backup-Tools','Migration','WSRM','TIFF-IFilter','WinRM-IIS-Ext','WINS-Server','Wireless-Networking','XPS-Viewer')]
        [string[]]$Present,
        [ValidateSet('AD-Certificate','ADCS-Cert-Authority','ADCS-Web-Enrollment','ADCS-Enroll-Web-Svc','ADCS-Enroll-Web-Pol','AD-Domain-Services','ADDS-Domain-Controller','ADDS-Identity-Mgmt','ADDS-NIS','ADDS-Password-Sync','ADDS-IDMU-Tools','AD-Federation-Services','ADFS-Federation','ADFS-Proxy','ADFS-Web-Agents','ADFS-Claims','ADFS-Windows-Token','ADLDS','ADRMS','ADRMS-Server','ADRMS-Identity','Application-Server','AS-NET-Framework','AS-Web-Support','AS-Ent-Services','AS-TCP-Port-Sharing','AS-WAS-Support','AS-HTTP-Activation','AS-MSMQ-Activation','AS-TCP-Activation','AS-Named-Pipes','AS-Dist-Transaction','AS-Incoming-Trans','AS-Outgoing-Trans','AS-WS-Atomic','DHCP','DNS','Fax','File-Services','FS-FileServer','FS-DFS','FS-DFS-Namespace','FS-DFS-Replication','FS-Resource-Manager','FS-NFS-Services','FS-Search-Service','FS-Win2003-Services','FS-Indexing-Service','FS-BranchCache','Hyper-V','NPAS','NPAS-Policy-Server','NPAS-RRAS-Services','NPAS-RRAS','NPAS-Routing','NPAS-Health','NPAS-Host-Cred','Print-Services','Print-Server','Print-LPD-Service','Print-Internet','Print-Scan-Server','Remote-Desktop-Services','RDS-RD-Server','RDS-Virtualization','RDS-Virtualization-Core','RDS-RemoteFX','RDS-Licensing','RDS-Connection-Broker','RDS-Gateway','RDS-Web-Access','Web-Server','Web-WebServer','Web-Common-Http','Web-Static-Content','Web-Default-Doc','Web-Dir-Browsing','Web-Http-Errors','Web-Http-Redirect','Web-DAV-Publishing','Web-App-Dev','Web-Asp-Net','Web-Net-Ext','Web-ASP','Web-CGI','Web-ISAPI-Ext','Web-ISAPI-Filter','Web-Includes','Web-Health','Web-Http-Logging','Web-Log-Libraries','Web-Request-Monitor','Web-Http-Tracing','Web-Custom-Logging','Web-ODBC-Logging','Web-Security','Web-Basic-Auth','Web-Windows-Auth','Web-Digest-Auth','Web-Client-Auth','Web-Cert-Auth','Web-Url-Auth','Web-Filtering','Web-IP-Security','Web-Performance','Web-Stat-Compression','Web-Dyn-Compression','Web-Mgmt-Tools','Web-Mgmt-Console','Web-Scripting-Tools','Web-Mgmt-Service','Web-Mgmt-Compat','Web-Metabase','Web-WMI','Web-Lgcy-Scripting','Web-Lgcy-Mgmt-Console','Web-Ftp-Server','Web-Ftp-Service','Web-Ftp-Ext','Web-WHC','WDS','WDS-Deployment','WDS-Transport','OOB-WSUS','NET-Framework','NET-Framework-Core','NET-Win-CFAC','NET-HTTP-Activation','NET-Non-HTTP-Activ','BITS','BITS-Compact-Server','BITS-IIS-Ext','BitLocker','BranchCache','CMAK','Desktop-Experience','DAMC','GPMC','Ink-Handwriting','IH-Ink-Support','IH-Handwriting','Internet-Print-Client','ISNS','LPR-Port-Monitor','MSMQ','MSMQ-Services','MSMQ-Server','MSMQ-Directory','MSMQ-Triggers','MSMQ-HTTP-Support','MSMQ-Multicasting','MSMQ-Routing','MSMQ-DCOM','Multipath-IO','NLB','PNRP','qWave','Remote-Assistance','RDC','RSAT','RSAT-Role-Tools','RSAT-ADCS','RSAT-ADCS-Mgmt','RSAT-AD-Tools','RSAT-ADDS','RSAT-ADDS-Tools','RSAT-AD-AdminCenter','RSAT-SNIS','RSAT-ADLDS','RSAT-AD-PowerShell','RSAT-RMS','RSAT-DHCP','RSAT-DNS-Server','RSAT-Fax','RSAT-File-Services','RSAT-DFS-Mgmt-Con','RSAT-FSRM-Mgmt','RSAT-NFS-Admin','RSAT-Hyper-V','RSAT-NPAS','RSAT-Print-Services','RSAT-RDS','RSAT-RDS-RemoteApp','RSAT-RDS-Gateway','RSAT-RDS-Licensing','RSAT-RDS-Conn-Broker','RSAT-Web-Server','RSAT-WDS','RSAT-Feature-Tools','RSAT-BitLocker','RSAT-Bitlocker-DriveEnc','RSAT-Bitlocker-RecPwd','RSAT-Bits-Server','RSAT-Clustering','RSAT-NLB','RSAT-SMTP','RSAT-WINS','RPC-over-HTTP-Proxy','Simple-TCPIP','SMTP-Server','SNMP-Services','SNMP-Service','SNMP-WMI-Provider','Storage-Mgr-SANS','Subsystem-UNIX-Apps','Telnet-Client','Telnet-Server','TFTP-Client','Biometric-Framework','Windows-Internal-DB','PowerShell-ISE','WAS','WAS-Process-Model','WAS-NET-Environment','WAS-Config-APIs','Backup-Features','Backup','Backup-Tools','Migration','WSRM','TIFF-IFilter','WinRM-IIS-Ext','WINS-Server','Wireless-Networking','XPS-Viewer')]
        [string[]]$Absent
    )

    Import-DscResource -ModuleName 'PSDesiredStateConfiguration'
    
    foreach ($feature in $Present) {
        WindowsFeature ("{0}_Present" -f $feature) {
            Name = $feature
            Ensure = "Present"
        }
    }

    foreach ($feature in $Absent) {
        WindowsFeature ("{0}_Absent" -f $feature) {
            Name = $feature
            Ensure = "Absent"
        }
    }
}